# Local Development

Set up MetaMCP for local development and testing.

## Prerequisites

- Node.js 18+ 
- pnpm 8+
- PostgreSQL 14+
- Git

## Quick Setup

1. **Clone the repository**:
```bash
git clone https://github.com/metatool-ai/metamcp.git
cd metamcp
```

2. **Install dependencies**:
```bash
pnpm install
```

3. **Set up environment**:
```bash
cp example.env .env
```

4. **Configure database**:
Edit `.env` with your PostgreSQL settings:
```env
DATABASE_URL=postgresql://username:password@localhost:5432/metamcp
```

5. **Run database migrations**:
```bash
cd apps/backend
pnpm db:migrate
```

6. **Start development servers**:
```bash
# From project root
pnpm dev
```

This starts:
- Frontend: http://localhost:3000
- Backend: http://localhost:8000

## Database Setup

### PostgreSQL Installation

**macOS (Homebrew)**:
```bash
brew install postgresql
brew services start postgresql
createdb metamcp
```

**Ubuntu/Debian**:
```bash
sudo apt update
sudo apt install postgresql postgresql-contrib
sudo systemctl start postgresql
sudo -u postgres createdb metamcp
```

**Windows**:
Download and install from [PostgreSQL.org](https://www.postgresql.org/download/windows/)

### Database Configuration

1. **Create user and database**:
```sql
-- Connect to PostgreSQL
psql -U postgres

-- Create user
CREATE USER metamcp WITH PASSWORD 'your_password';

-- Create database
CREATE DATABASE metamcp OWNER metamcp;

-- Grant privileges
GRANT ALL PRIVILEGES ON DATABASE metamcp TO metamcp;
```

2. **Update environment**:
```env
DATABASE_URL=postgresql://metamcp:your_password@localhost:5432/metamcp
```

## Development Workflow

### Project Structure

```
metamcp/
├── apps/
│   ├── frontend/          # Next.js frontend
│   └── backend/           # Express.js backend
├── packages/
│   ├── trpc/             # tRPC routers
│   ├── zod-types/        # Shared type definitions
│   └── eslint-config/    # ESLint configurations
```

### Available Scripts

**Root level**:
```bash
pnpm dev          # Start all development servers
pnpm build        # Build all applications
pnpm lint         # Lint all packages
pnpm clean        # Clean build artifacts
```

**Backend** (`apps/backend`):
```bash
pnpm dev          # Start backend in development
pnpm build        # Build for production
pnpm start        # Start production server
pnpm db:migrate   # Run database migrations
pnpm db:studio    # Open Drizzle Studio
```

**Frontend** (`apps/frontend`):
```bash
pnpm dev          # Start Next.js development server
pnpm build        # Build for production
pnpm start        # Start production server
```

## Environment Variables

### Required Variables

```env
# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/metamcp

# Authentication
BETTER_AUTH_SECRET=your-32-character-secret-key
BETTER_AUTH_URL=http://localhost:3000

# Development
NODE_ENV=development
```

### Optional Variables

```env
# OAuth Providers
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# API Configuration
CORS_ORIGIN=http://localhost:3000
API_BASE_URL=http://localhost:8000
```

## Troubleshooting

### Common Issues

1. **Port already in use**:
```bash
# Kill process on port 3000
lsof -ti:3000 | xargs kill -9

# Kill process on port 8000  
lsof -ti:8000 | xargs kill -9
```

2. **Database connection failed**:
```bash
# Check PostgreSQL status
pg_ctl status

# Restart PostgreSQL (macOS)
brew services restart postgresql

# Restart PostgreSQL (Linux)
sudo systemctl restart postgresql
```

3. **Module not found errors**:
```bash
# Clean and reinstall
rm -rf node_modules
rm pnpm-lock.yaml
pnpm install
```

4. **Permission denied**:
```bash
# Fix npm permissions (macOS/Linux)
sudo chown -R $(whoami) ~/.npm
```

### Development Tools

**Database Management**:
```bash
# Open Drizzle Studio
cd apps/backend
pnpm db:studio
```

**API Testing**:
- Backend API docs: http://localhost:8000/api/docs
- tRPC panel: http://localhost:8000/panel

**Logs and Debugging**:
```bash
# Backend logs
cd apps/backend
pnpm dev --verbose

# Frontend logs  
cd apps/frontend
pnpm dev --turbo
```

## Hot Reload

The development setup includes hot reload for:
- Frontend React components
- Backend API routes
- Shared packages (trpc, zod-types)

Changes in shared packages automatically trigger rebuilds in dependent applications.

## Testing

```bash
# Run all tests
pnpm test

# Run tests in watch mode
pnpm test:watch

# Run tests with coverage
pnpm test:coverage
``` 