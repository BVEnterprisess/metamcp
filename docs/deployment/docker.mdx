# Docker Deployment

Deploy MetaMCP using Docker for a containerized, production-ready setup.

## Prerequisites

- Docker 20.10+
- Docker Compose 2.0+
- At least 2GB RAM
- 10GB disk space

## Quick Start with Docker Compose

1. **Clone the repository**:
```bash
git clone https://github.com/metatool-ai/metamcp.git
cd metamcp
```

2. **Copy environment file**:
```bash
cp example.env .env
```

3. **Configure environment variables**:
Edit `.env` file with your settings:
```env
# Database
DATABASE_URL=postgresql://metamcp:password@db:5432/metamcp

# Authentication
BETTER_AUTH_SECRET=your-secret-key-here
BETTER_AUTH_URL=http://localhost:3000

# Optional: OAuth providers
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
```

4. **Start the services**:
```bash
docker-compose up -d
```

5. **Access the application**:
- Frontend: http://localhost:3000
- Backend API: http://localhost:8000

## Production Deployment

### Using Docker Compose

For production, use the production compose file:

```bash
docker-compose -f docker-compose.yml up -d
```

### Environment Variables

Key environment variables for production:

| Variable | Description | Required |
|----------|-------------|----------|
| `DATABASE_URL` | PostgreSQL connection string | Yes |
| `BETTER_AUTH_SECRET` | Secret key for authentication | Yes |
| `BETTER_AUTH_URL` | Base URL of your application | Yes |
| `NODE_ENV` | Set to `production` | Yes |
| `PORT` | Backend port (default: 8000) | No |

### Health Checks

Docker containers include health checks:

```bash
# Check container status
docker-compose ps

# View logs
docker-compose logs -f
```

### Scaling

Scale specific services:

```bash
# Scale backend instances
docker-compose up -d --scale backend=3

# Scale with load balancer
docker-compose -f docker-compose.yml -f docker-compose.scale.yml up -d
```

## Troubleshooting

### Common Issues

1. **Port conflicts**:
```bash
# Check port usage
sudo lsof -i :3000
sudo lsof -i :8000
```

2. **Database connection issues**:
```bash
# Check database logs
docker-compose logs db

# Reset database
docker-compose down -v
docker-compose up -d
```

3. **Permission issues**:
```bash
# Fix file permissions
sudo chown -R $USER:$USER .
```

### Logs and Debugging

```bash
# View all logs
docker-compose logs

# Follow specific service logs
docker-compose logs -f backend
docker-compose logs -f frontend

# Access container shell
docker-compose exec backend sh
```

## Updates

To update to the latest version:

```bash
# Pull latest images
docker-compose pull

# Restart services
docker-compose up -d

# Clean up old images
docker image prune
``` 